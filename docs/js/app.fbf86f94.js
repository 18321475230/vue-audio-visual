(function(t){function e(e){for(var a,o,s=e[0],l=e[1],h=e[2],u=0,d=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);c&&c(e);while(d.length)d.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,s=1;s<i.length;s++){var l=i[s];0!==n[l]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},n={app:0},r=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/vue-audio-visual/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var h=0;h<s.length;h++)e(s[h]);var c=l;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var a=i("85ec"),n=i.n(a);n.a},"56d7":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=(i("0ffc"),i("46d4"),i("966c"),i("c770"),i("581e"),i("253f"),i("7e9e"),i("241c"),i("90fa"),i("feeb"),i("1c98"),i("06a3"),i("1ca0"),i("3a0c"),i("9426"),i("100a"),i("3051"),i("9598"),i("2731"),i("587f"),i("c60d"),i("b285"),i("6a35"),i("b391"),i("1234"),i("dfa9"),i("7c3f"),i("2d6b"),i("0312"),i("1f3b"),i("c666"),i("705d"),i("dddc"),{audioSrc:{type:String,default:null},refLink:{type:String,default:null},audioControls:{type:Boolean,default:!0},corsAnonym:{type:Boolean,default:!1},audioClass:{type:String,default:null},canvWidth:{type:Number,default:300},canvHeight:{type:Number,default:80},canvClass:{type:String,default:null},canvTop:{type:Boolean,default:!1},canvFillColor:{type:[String,Array],default:null}}),r={createHTMLElements:function(){var t=document.createElement("canvas"),e=document.createElement("div"),i=null,a=null;this.refLink?a=this.$parent.$refs[this.refLink]:(a=document.createElement("audio"),i=document.createElement("div"),a.setAttribute("src",this.audioSrc),this.audioControls&&a.setAttribute("controls",!0),this.audioClass&&a.setAttribute("class",this.audioClass),this.corsAnonym&&(a.crossOrigin="anonymous"),i.appendChild(a),this.$el.appendChild(i)),this.canvClass&&t.setAttribute("class",this.canvClass),this.canvWidth&&t.setAttribute("width",this.canvWidth),this.canvHeight&&t.setAttribute("height",this.canvHeight),e.appendChild(t),this.canvTop?this.$el.insertBefore(e,i):this.$el.appendChild(e),this.ctxWrapper=t,this.ctx=t.getContext("2d"),this.audio=a,this.audio.load()},setAnalyser:function(){this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser();var t=this.audioCtx.createMediaElementSource(this.audio);t.connect(this.analyser),this.analyser.fftSize=this.fftSize,this.analyser.connect(this.audioCtx.destination)},fillGradient:function(t){var e=this.canvWidth,i=this.canvHeight,a=this.ctx.createLinearGradient(e/2,0,e/2,i),n=0;return t.forEach((function(e){a.addColorStop(n,e),n+=1/t.length})),a}},o={props:n,render:function(t){return t("div")},mounted:function(){var t=this;this.createHTMLElements(),this.audio.onplay=function(){t.audioCtx||t.setAnalyser(),t.mainLoop(),t.audioCtx&&t.audioCtx.resume()},this.audio.onpause=function(){t.audioCtx&&(t.audioCtx.suspend(),cancelAnimationFrame(t.animId))}},beforeDestroy:function(){this.audioCtx&&this.audioCtx.suspend(),cancelAnimationFrame(this.animId)},methods:r},s={barWidth:{type:Number,default:5},barSpace:{type:Number,default:1},barColor:{type:[String,Array],default:"#0A0AFF"},capsHeight:{type:Number,default:0},capsDropSpeed:{type:Number,default:.9},capsColor:{type:String,default:"#A0A0FF"},brickHeight:{type:Number,default:0},brickSpace:{type:Number,default:1},symmetric:{type:Boolean,default:!1},fftSize:{type:Number,default:1024}},l={name:"av-bars",mixins:[o],props:s,data:function(){return{animId:null,audio:null,analyser:null,ctx:null,audioCtx:null,caps:Array.apply(null,Array(this.fftSize/2)).map((function(){return 0}))}},methods:{mainLoop:function(){var t=this,e=this.analyser.frequencyBinCount,i=new Uint8Array(e),a=this.barWidth>=this.canvWidth?this.canvWidth:this.barWidth,n=Math.round((a+this.barSpace)/e*this.canvWidth),r=Array.isArray(this.barColor)?this.fillGradient(this.barColor):this.barColor,o=0;this.analyser.getByteFrequencyData(i),this._fillCanvasBG(),i.forEach((function(e,s){if(!(s%n)){var l=Math.round(i.slice(s,s+n).reduce((function(t,e){return e+t}),0)/n),h=l/255*t.canvHeight;t.capsHeight&&t._drawCap(s,a,o,l),t.ctx.fillStyle=r,t._drawBar(a,h,o),o+=a+t.barSpace}})),this.animId=requestAnimationFrame(this.mainLoop)},_fillCanvasBG:function(){var t=this.canvWidth,e=this.canvHeight;this.ctx.clearRect(0,0,t,e),this.canvFillColor&&(this.ctx.fillStyle=Array.isArray(this.canvFillColor)?this.fillGradient(this.canvFillColor):this.canvFillColor,this.ctx.fillRect(0,0,t,e))},_drawBar:function(t,e,i){this.brickHeight?this._drawBrickBar(t,e,i):this.ctx.fillRect(i,this.canvHeight-e-this._symAlign(e),t,e)},_drawBrickBar:function(t,e,i){for(var a=0;a<e;a+=this.brickHeight+this.brickSpace)this.ctx.fillRect(i,this.canvHeight-e+a-this._symAlign(e),t,this.brickHeight)},_drawCap:function(t,e,i,a){var n=this.caps[t]<=a?a:this.caps[t]-this.capsDropSpeed,r=n/255*this.canvHeight,o=this.canvHeight-r-this.capsHeight-this._symAlign(r);this.ctx.fillStyle=this.capsColor,this.ctx.fillRect(i,o,e,this.capsHeight),this.symmetric&&this.ctx.fillRect(i,this.canvHeight-o-this.capsHeight,e,this.capsHeight),this.caps[t]=n},_symAlign:function(t){return this.symmetric?(this.canvHeight-t)/2:0}}},h=l,c={lineWidth:{type:Number,default:2},lineColor:{type:[String,Array],default:"#9F9"},fftSize:{type:Number,default:128}},u={name:"av-line",mixins:[o],props:c,data:function(){return{animId:null,audio:null,analyser:null,ctx:null,audioCtx:null}},methods:{mainLoop:function(){var t=this.analyser.frequencyBinCount,e=this.canvWidth/2/t,i=new Uint8Array(t),a=0;this._setCanvas(),this.analyser.getByteFrequencyData(i),this.ctx.lineWidth=this.lineWidth,this.ctx.strokeStyle=Array.isArray(this.lineColor)?this.fillGradient(this.lineColor):this.lineColor,this.ctx.beginPath(),i.reverse(),this.ctx.moveTo(a,this.canvHeight/2),a=this._drawLine(i,a,e),i.reverse(),a=this._drawLine(i,a,e),this.ctx.lineTo(this.canvWidth,this.canvHeight/2),this.ctx.stroke(),this.animId=requestAnimationFrame(this.mainLoop)},_setCanvas:function(){var t=this.canvWidth,e=this.canvHeight,i=this.canvFillColor,a=this.ctx.createLinearGradient(t/2,0,t/2,e),n=0;this.ctx.clearRect(0,0,t,e),i&&(Array.isArray(i)?(i.forEach((function(t){a.addColorStop(n,t),n+=1/i.length})),this.ctx.fillStyle=a):this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e))},_drawLine:function(t,e,i){var a=this,n=this.canvHeight,r=0;return t.forEach((function(t,o){r=n*(255-t)/510,o%2&&(r=n-r),a.ctx.lineTo(e,r),e+=i})),e}}},d=u,f=(i("862d"),{fftSize:{type:Number,default:1024},canvWidth:{type:Number,default:100},canvHeight:{type:Number,default:100},radius:{type:Number,default:0},lineWidth:{type:Number,default:1},lineSpace:{type:Number,default:1},outlineColor:{type:String,default:"#0000FF"},outlineWidth:{type:Number,default:.3},barWidth:{type:Number,default:1},barLength:{type:Number,default:0},barColor:{type:[String,Array],default:function(){return["#FFFFFF","#0000FF"]}},progress:{type:Boolean,default:!0},progressWidth:{type:Number,default:1},progressColor:{type:String,default:"#0000FF"},progressClockwise:{type:Boolean,default:!1},outlineMeterSpace:{type:Number,default:3},playtime:{type:Boolean,default:!1},playtimeFont:{type:String,default:"14px Monaco"},playtimeColor:{type:String,default:"#00f"},rotateGraph:{type:Boolean,default:!1},rotateSpeed:{type:Number,default:.001}}),p={name:"av-circle",mixins:[o],props:f,data:function(){return{animId:null,rotate:1.5,audio:null,analyser:null,ctx:null,audioCtx:null}},methods:{mainLoop:function(){var t=this,e=this.canvWidth/2,i=this.canvHeight/2,a=this.radius?this.radius:Math.round(this.canvWidth/2*.7),n=this.lineWidth,r=this.lineSpace,o=Math.ceil(n+r),s=this.analyser.frequencyBinCount,l=new Uint8Array(s),h=(n+r)/l.length*(2*Math.PI),c=this.barLength>0?this.barLength:this.canvWidth/2-a,u=Math.PI*this._rotate();this._setCanvas(),this.analyser.getByteFrequencyData(l),this.outlineWidth>0&&this._drawOutline(a,e,i),this.progress&&this._drawProgress(a,e,i),this.playtime&&this._drawPlaytime(e,i),this.ctx.lineWidth=this.barWidth,this.ctx.strokeStyle=this._setBarColor(e,i),l.forEach((function(n,r){if(u+=h,!(r%o)){var s=Math.round(l.slice(r,r+o).reduce((function(t,e){return e+t}),0)/o),d=a+s/255*c;t.ctx.beginPath(),t.ctx.moveTo(a*Math.cos(u)+e,a*Math.sin(u)+i),t.ctx.lineTo(d*Math.cos(u)+e,d*Math.sin(u)+i),t.ctx.stroke()}})),this.animId=requestAnimationFrame(this.mainLoop)},_setCanvas:function(){this.ctx.clearRect(0,0,this.canvWidth,this.canvHeight),this.canvFillColor&&(this.ctx.fillStyle=Array.isArray(this.canvFillColor)?this.fillGradient(this.canvFillColor):this.canvFillColor,this.ctx.fillRect(0,0,this.canvWidth,this.canvHeight))},_drawProgress:function(t,e,i){var a=this.audio.currentTime/this.audio.duration*2*Math.PI,n=1.5*Math.PI+a;a&&(this.ctx.lineWidth=this.progressWidth,this.ctx.strokeStyle=this.progressColor,this.ctx.beginPath(),this.ctx.arc(e,i,t-this.outlineWidth-this.outlineMeterSpace,1.5*Math.PI,n,this.progressClockwise),this.ctx.stroke())},_drawOutline:function(t,e,i){this.ctx.beginPath(),this.ctx.strokeStyle=this.outlineColor,this.ctx.lineWidth=this.outlineWidth,this.ctx.arc(e,i,t,0,2*Math.PI),this.ctx.stroke()},_drawPlaytime:function(t,e){var i=Math.floor(this.audio.currentTime/60),a=Math.floor(this.audio.currentTime)%60,n=a<10?"0".concat(a):"".concat(a),r="".concat(i,":").concat(n),o=Math.ceil(this.ctx.measureText(r).width);this.ctx.font=this.playtimeFont,this.ctx.fillStyle=this.playtimeColor,this.ctx.fillText(r,t-Math.round(o/2),e+.25*parseInt(this.playtimeFont))},_rotate:function(){return this.rotateGraph?this.rotate=3.5===this.rotate?1.5:this.rotate+this.rotateSpeed:this.rotate=1.5,this.rotate},_setBarColor:function(t,e){var i=this;if(!Array.isArray(this.barColor))return this.barColor;var a=this.ctx.createRadialGradient(t,e,this.canvWidth/2,t,e,0),n=0;return this.barColor.forEach((function(t){a.addColorStop(n,t),n+=1/i.barColor.length})),a}}},m=p,y=i("7338"),v=i.n(y),x={canvWidth:{type:Number,default:500},canvHeight:{type:Number,default:80},playedLineWidth:{type:Number,default:.5},playedLineColor:{type:String,default:"navy"},noplayedLineWidth:{type:Number,default:.5},noplayedLineColor:{type:String,default:"lime"},playtime:{type:Boolean,default:!0},playtimeWithMs:{type:Boolean,default:!0},playtimeFontSize:{type:Number,default:12},playtimeFontFamily:{type:String,default:"monospace"},playtimeFontColor:{type:String,default:"grey"},playtimeTextBottom:{type:Boolean,default:!1},playtimeSlider:{type:Boolean,default:!0},playtimeSliderColor:{type:String,default:"red"},playtimeSliderWidth:{type:Number,default:1},playtimeClickable:{type:Boolean,default:!0}},g={name:"av-waveform",mixins:[o],props:x,data:function(){return{animId:null,ctxWrapper:null,ctx:null,audio:null,duration:null,peaks:[]}},mounted:function(){var t=this,e={responseType:"arraybuffer",onDownloadProgress:this.downloadProgress};v.a.get(this.audio.src,e).then((function(e){return t.decode(e)})).catch((function(e){console.error("Failed to get file '".concat(t.audio.src,"'")),console.log(e)})),this.audio.onplay=function(){t.animId=requestAnimationFrame(t.waveformAnim)},this.audio.onpause=function(){cancelAnimationFrame(t.animId),t.animId=null}},methods:{setAnalyser:function(){return null},mainLoop:function(){return null},decode:function(t){var e=this,i=new AudioContext;i.decodeAudioData(t.data,(function(t){e.setPeaks(t)}),(function(t){console.error("Failed to decode audio data."),console.log(t)}))},setPeaks:function(t){var e=this,i=[],a=0,n=0,r=0,o=0,s=Math.ceil(t.length/this.canvWidth),l=this.canvWidth,h=this.canvHeight;this.duration=t.duration;for(var c=0;c<t.numberOfChannels;c++)for(var u=t.getChannelData(c),d=0;d<l;d++){var f=~~(d*s),p=~~(f+s);a=0,n=0;for(var m=f;m<p;m++)a=u[m]<a?u[m]:a,n=u[m]>n?u[m]:n;i[d]&&(i[d][0]=i[d][0]<n?n:i[d][0],i[d][1]=i[d][1]>a?a:i[d][1]),i[d]=[n,a]}for(var y=0;y<i.length;y++)n=i[y][0],a=i[y][1],r=h/2-n*h/2,o=h/2-a*h/2,i[y]=[r,o===r?r+1:o];this.peaks=i,this.playtimeClickable&&this.ctxWrapper.addEventListener("click",(function(t){return e.updateTime(t)})),this.waveform()},waveform:function(){var t=this.peaks,e=this.audio.currentTime,i=this.playX(e),a=0;this.ctx.clearRect(0,0,this.canvWidth,this.canvHeight),a=this.draw(t.slice(0,i),this.playedLineWidth,this.playedLineColor,a),this.draw(t.slice(i),this.noplayedLineWidth,this.noplayedLineColor,a),this.drawSlider(e),this.drawTime(e)},waveformAnim:function(){this.waveform(),this.animId=requestAnimationFrame(this.waveformAnim)},draw:function(t,e,i,a){var n=this;return this.ctx.lineWidth=e,this.ctx.strokeStyle=i,this.ctx.beginPath(),t.forEach((function(t){n.ctx.moveTo(a,t[0]),n.ctx.lineTo(a,t[1]),a++})),this.ctx.stroke(),a},timeFormat:function(t){var e="",i=parseFloat(t);if(isNaN(i))return e;var a=~~(i/60),n=~~(i%60),r=~~(i%1*1e3);return e=a<10?"0".concat(a,":"):"".concat(a,":"),e+="0".concat(n).substr(-2),this.playtimeWithMs&&(e+="."+"00".concat(r).substr(-3)),e},drawTime:function(t){var e=this.timeFormat(t),i=3,a=~~this.ctx.measureText(e).width,n=this.playX(t),r=n>this.canvWidth-a-i?n-a-i:n+i,o=this.playtimeTextBottom?this.canvHeight-this.playtimeFontSize+i:this.playtimeFontSize+i;this.ctx.fillStyle=this.playtimeFontColor,this.ctx.font="".concat(this.playtimeFontSize,"px ").concat(this.playtimeFontFamily),this.ctx.fillText(e,r,o)},drawSlider:function(t){var e=this.playX(t);this.ctx.lineWidth=this.playtimeSliderWidth,this.ctx.strokeStyle=this.playtimeSliderColor,this.ctx.beginPath(),this.ctx.moveTo(e,0),this.ctx.lineTo(e,this.canvHeight),this.ctx.stroke()},playX:function(t){return~~(t/this.duration*this.canvWidth)},updateTime:function(t){this.audio.currentTime=t.offsetX/this.canvWidth*this.duration,this.animId||this.waveform()},downloadProgress:function(t){var e=Math.round(t.loaded/t.total*this.canvWidth);this.ctx.clearRect(0,0,this.canvWidth,this.canvHeight),this.ctx.beginPath(),this.ctx.strokeStyle=this.noplayedLineColor,this.ctx.moveTo(0,this.canvHeight/2),this.ctx.lineTo(e,this.canvHeight/2),this.ctx.stroke()}}},C=g,b={media:{type:MediaStream,required:!1,default:null},canvWidth:{type:Number,default:300},canvClass:{type:String,default:null},canvHeight:{type:Number,default:80},canvFillColor:{type:String,default:null},fftSize:{type:Number,default:null},type:{type:String,default:"wform"},frequLnum:{type:Number,default:60},frequLineCap:{type:Boolean,default:!1},lineColor:{type:String,default:"lime"},lineWidth:{type:Number,default:null}},S={name:"av-media",data:function(){return{ctx:null,audioCtx:null,analyser:null}},props:b,render:function(t){return t("div")},mounted:function(){this.createCanvas()},watch:{media:function(t,e){t&&this.setAnalyser(),this.draw()}},methods:{createCanvas:function(){var t=document.createElement("canvas");t.width=this.canvWidth,t.height=this.canvHeight,this.canvClass&&t.setAttribute("class",this.canvClass),this.ctx=t.getContext("2d"),this.$el.appendChild(t)},setAnalyser:function(){this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser();var t=this.audioCtx.createMediaStreamSource(this.media);t.connect(this.analyser),this.fftSize?this.analyser.fftSize=this.fftSize:this.analyser.fftSize="frequ"===this.type?1024:8192,this.analyser.connect(this.audioCtx.destination)},draw:function(){var t=new Uint8Array(this.analyser.fftSize);this.canvFillColor&&(this.ctx.fillStyle=this.canvFillColor),this.ctx.clearRect(0,0,this.canvWidth,this.canvHeight),this.ctx.beginPath(),this.ctx.strokeStyle=this.lineColor,"frequ"===this.type?(this.analyser.getByteFrequencyData(t),this.frequ(t)):(this.analyser.getByteTimeDomainData(t),this.wform(t)),requestAnimationFrame(this.draw)},wform:function(t){var e=this,i=this.canvHeight,a=this.canvWidth/this.analyser.fftSize,n=0;this.ctx.lineWidth=this.lineWidth||.5,t.forEach((function(t){var r=t/255*i;e.ctx.lineTo(n,r),n+=a})),this.ctx.stroke()},frequ:function(t){for(var e=this.frequLnum,i=this.canvWidth/e,a=this.canvHeight,n=this.lineWidth||2,r=0;r<e;r++){var o=r*i+n,s=t.slice(o,o+i).reduce((function(t,e){return t+e/255*a}),0)/i,l=(a-s)/2+2;this.ctx.lineWidth=n,this.ctx.lineCap=this.frequLineCap?"round":"butt",this.ctx.moveTo(o,l),this.ctx.lineTo(o,a-l),this.ctx.stroke()}}}},w=S,A={install:function(t){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t.component(h.name,h),t.component(d.name,d),t.component(m.name,m),t.component(C.name,C),t.component(w.name,w)}},W=A,F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("img",{attrs:{alt:"logo",src:"logo.png"}}),i("h1",[t._v("vue-audio-visual demo")]),i("blockquote",[t._v(" Audio source is from https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_1MG.mp3 ")]),i("hr"),i("AvLines")],1)},_=[],H=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h3",[t._v("Demo of av-line component")]),i("pre",[t._v("  See source code in file demo/src/components/AvLines.vue\n  ")]),i("av-line",{attrs:{"line-width":2,"line-color":"lime","audio-src":"/file_example_MP3_1MG.mp3"}})],1)},k=[],M={name:"av-lines"},L=M,T=i("2877"),N=Object(T["a"])(L,H,k,!1,null,"a469baa2",null),B=N.exports,P={name:"App",components:{AvLines:B}},q=P,I=(i("034f"),Object(T["a"])(q,F,_,!1,null,null,null)),z=I.exports;a["a"].config.productionTip=!1,a["a"].use(W),new a["a"]({render:function(t){return t(z)}}).$mount("#app")},"85ec":function(t,e,i){}});
//# sourceMappingURL=app.fbf86f94.js.map